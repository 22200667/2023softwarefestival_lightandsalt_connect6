This is the merged version.
This code uses several models.
